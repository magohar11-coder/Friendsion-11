<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Friendsion Diary</title>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:#6b4b3e;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

/* LOGIN */
#login{
    text-align:center;
    color:#fff;
}
#login button{
    padding:15px 30px;
    background:gold;
    border:none;
    border-radius:30px;
    font-weight:bold;
    cursor:pointer;
}

/* BOOK */
.book{
    width:800px;
    height:500px;
    position:relative;
    perspective:2000px;
}

.page{
    width:100%;
    height:100%;
    position:absolute;
    background:#fff8dc;
    border-radius:10px;
    transform-origin:left;
    transition:transform 1s;
    box-shadow:0 0 10px rgba(0,0,0,0.5);
    padding:20px;
    box-sizing:border-box;
    overflow:auto;
}

.page.flipped{
    transform:rotateY(-180deg);
}

.controls{
    position:absolute;
    bottom:-60px;
    width:100%;
    text-align:center;
}

button{
    padding:10px 20px;
    margin:5px;
    background:gold;
    border:none;
    border-radius:20px;
    cursor:pointer;
    font-weight:bold;
}

textarea{
    width:100%;
    height:100px;
    padding:10px;
    border-radius:10px;
    border:1px solid #ccc;
}

.post{
    margin-bottom:10px;
    padding:10px;
    background:#fff;
    border-radius:8px;
    box-shadow:0 2px 5px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<div id="login">
    <h1>Friendsion Diary</h1>
    <button onclick="login()">Login with Gmail</button>
</div>

<div id="app" style="display:none;">
    <div class="book">
        <!-- PAGE 1 -->
        <div class="page" id="page1">
            <h2>Write New Post</h2>
            <textarea id="postText" placeholder="Write your diary..."></textarea>
            <br><br>
            <button onclick="addPost()">Post</button>
        </div>

        <!-- PAGE 2 -->
        <div class="page" id="page2">
            <h2>Your Diary</h2>
            <div id="posts"></div>
        </div>

        <div class="controls">
            <button onclick="prevPage()">⬅ Prev</button>
            <button onclick="nextPage()">Next ➡</button>
            <button onclick="logout()" style="background:red;color:white;">Logout</button>
        </div>
    </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_PROJECT_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentPage = 1;
let me = null;

auth.onAuthStateChanged(user=>{
    if(user){
        me = user;
        document.getElementById("login").style.display="none";
        document.getElementById("app").style.display="block";
        loadPosts();
    }else{
        document.getElementById("login").style.display="block";
        document.getElementById("app").style.display="none";
    }
});

function login(){
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
}

function logout(){
    auth.signOut();
}

function nextPage(){
    if(currentPage===1){
        document.getElementById("page1").classList.add("flipped");
        currentPage=2;
    }
}

function prevPage(){
    if(currentPage===2){
        document.getElementById("page1").classList.remove("flipped");
        currentPage=1;
    }
}

function addPost(){
    let text=document.getElementById("postText").value;
    if(!text.trim()) return;

    db.ref("diary/"+me.uid).push({
        text:text,
        time:Date.now()
    });

    document.getElementById("postText").value="";
}

function loadPosts(){
    db.ref("diary/"+me.uid).on("value",snap=>{
        let postsDiv=document.getElementById("posts");
        postsDiv.innerHTML="";
        snap.forEach(child=>{
            let p=child.val();
            postsDiv.innerHTML+=`
            <div class="post">
                ${p.text}
            </div>`;
        });
    });
}
</script>

</body>
</html>
