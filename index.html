<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DiaryBook Social</title>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#667eea,#764ba2);
color:white;
}

.topbar{
background:#3b5998;
padding:15px;
display:flex;
justify-content:space-between;
}

.container{
width:90%;
max-width:600px;
margin:auto;
margin-top:20px;
}

.postBox{
background:white;
color:black;
padding:15px;
border-radius:10px;
margin-bottom:20px;
}

button{
background:#3b5998;
color:white;
border:none;
padding:8px 12px;
border-radius:5px;
cursor:pointer;
}

.post{
background:white;
color:black;
padding:15px;
border-radius:10px;
margin-bottom:20px;
}

.diary{
width:100%;
height:300px;
position:relative;
perspective:1000px;
margin-top:10px;
}

.page{
position:absolute;
width:100%;
height:100%;
background:#fffaf0;
border-radius:10px;
padding:15px;
box-shadow:0 5px 10px rgba(0,0,0,0.3);
transform-origin:left;
transition:0.6s;
overflow:auto;
}

.cover{
background-size:cover;
background-position:center;
color:white;
display:flex;
align-items:center;
justify-content:center;
font-size:20px;
font-weight:bold;
}

.flipped{
transform:rotateY(-180deg);
}

.commentBox{
margin-top:10px;
}

input,textarea,select{
width:100%;
margin-top:5px;
padding:5px;
}

</style>
</head>
<body>

<div class="topbar">
<div>DiaryBook</div>
<div><a href="chat.html" style="color:white;">Messenger</a></div>
</div>

<div class="container">

<div class="postBox">
<h3>Create Diary Post</h3>
<input type="text" id="username" placeholder="Your Name">
<select id="mood">
<option value="happy">üòä Happy</option>
<option value="sad">üò¢ Sad</option>
<option value="love">‚ù§Ô∏è Love</option>
<option value="angry">üò° Angry</option>
</select>
<textarea id="text" placeholder="Write your diary..." rows="4"></textarea>
<button onclick="postDiary()">Post</button>
</div>

<div id="feed"></div>

</div>

<script>

const firebaseConfig={
apiKey:"YOUR_API_KEY",
authDomain:"YOUR_AUTH_DOMAIN",
databaseURL:"YOUR_DB_URL",
projectId:"YOUR_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

function getCover(mood){
if(mood=="sad") return "https://i.imgur.com/8Km9tLL.jpg";
if(mood=="happy") return "https://i.imgur.com/2DhmtJ4.jpg";
if(mood=="love") return "https://i.imgur.com/Qp5Yw.jpg";
if(mood=="angry") return "https://i.imgur.com/9XnK.jpg";
}

function postDiary(){
let name=document.getElementById("username").value;
let text=document.getElementById("text").value;
let mood=document.getElementById("mood").value;

if(!name||!text) return alert("Fill all fields");

let pages=text.match(/.{1,300}/g);

db.ref("posts").push({
name:name,
text:text,
pages:pages,
mood:mood,
cover:getCover(mood),
likes:0,
time:Date.now()
});

document.getElementById("text").value="";
}

db.ref("posts").on("value",snap=>{
let feed=document.getElementById("feed");
feed.innerHTML="";

snap.forEach(child=>{
let d=child.val();
let id=child.key;

feed.innerHTML+=`
<div class="post">
<b>${d.name}</b><br>
Mood: ${d.mood}<br>

<div class="diary" onclick="flip('${id}')">
<div class="page cover" id="cover${id}" style="background-image:url('${d.cover}')">
Click to Open Diary
</div>
<div class="page" id="page${id}">
${d.text}
</div>
</div>

<br>
<button onclick="likePost('${id}')">‚ù§Ô∏è Like (${d.likes})</button>

<div class="commentBox">
<input type="text" id="c${id}" placeholder="Write comment">
<button onclick="comment('${id}')">Comment</button>
<div id="comments${id}"></div>
</div>

</div>
`;
});

});

function flip(id){
document.getElementById("cover"+id).classList.toggle("flipped");
}

function likePost(id){
db.ref("posts/"+id+"/likes").transaction(l=> (l||0)+1);
}

function comment(id){
let text=document.getElementById("c"+id).value;
if(!text) return;
db.ref("posts/"+id+"/comments").push({text:text});
}

</script>
</body>
</html>
