<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendsion 11</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', Helvetica, Arial, sans-serif; background: #f0f2f5; margin: 0; }

        /* --- 1. LOGIN PAGE (Front Page) --- */
        #loginPage { 
            background: #5d4037; height: 100vh; display: flex; 
            flex-direction: column; align-items: center; justify-content: center; 
            color: #f1c40f; text-align: center; 
        }

        /* --- 2. MAIN PAGE (Post Feed Page) --- */
        #mainAppPage { display: none; } /* Shuru mein ye chhupa rahega */
        
        .fb-navbar { 
            background: #1877f2; color: white; padding: 10px 15px; 
            position: sticky; top: 0; z-index: 100; display: flex; 
            justify-content: space-between; align-items: center; 
        }
        
        .main-container { max-width: 500px; margin: auto; padding: 10px; }
        
        /* Post Box (Jahan se likhte hain) */
        .create-post { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 1px 2px rgba(0,0,0,.1); }
        .create-post textarea { 
            width: 100%; border: none; background: #f0f2f5; 
            border-radius: 20px; padding: 10px 15px; font-size: 16px; outline: none; 
        }
        
        /* Actual Post (Facebook Style Feed) */
        .fb-post { 
            background: white; border-radius: 8px; padding: 12px; 
            margin-bottom: 12px; border: 1px solid #dddfe2; box-shadow: 0 1px 2px rgba(0,0,0,.1);
        }
        .post-top { display: flex; align-items: center; margin-bottom: 10px; }
        .post-top img { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }
        .post-content { font-size: 16px; color: #050505; margin-bottom: 10px; }
        
        .btn-blue { background: #1877f2; color: white; border: none; width: 100%; padding: 10px; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="loginPage">
        <h1 style="font-size: 3rem;">Friendsion 11</h1>
        <p>The Golden Diary of Memories</p><br>
        <button onclick="login()" style="background:#f1c40f; padding:15px 30px; border-radius:30px; border:none; font-weight:bold; cursor:pointer;">Unlock Diary</button>
    </div>

    <div id="mainAppPage">
        <div class="fb-navbar">
            <h2 style="margin:0;">friendsion</h2>
            <img id="userIcon" style="width:35px; border-radius:50%; border:1px solid white;">
        </div>

        <div class="main-container">
            <div class="create-post">
                <textarea id="msg" placeholder="What's in your memory today?"></textarea>
                <button class="btn-blue" onclick="postNow()">Post Memory</button>
            </div>

            <div id="postFeed"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCuv48za3h_bDFbwXW3RXuS5ZrRJ4VfQLA",
            authDomain: "friendsion-11.firebaseapp.com",
            databaseURL: "https://friendsion-11-default-rtdb.firebaseio.com",
            projectId: "friendsion-11",
            storageBucket: "friendsion-11.appspot.com",
            messagingSenderId: "358544393520",
            appId: "1:358544393520:web:77918a24559b15d658c14d"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // 1. Login Function
        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithRedirect(provider);
        }

        // 2. Page Jumper Logic (Ye check karta hai kab kaunsa page dikhana hai)
        auth.onAuthStateChanged(user => {
            if (user) {
                // Agar login hai toh Login Page chhupao aur Main Page dikhao
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainAppPage').style.display = 'block';
                document.getElementById('userIcon').src = user.photoURL;
                loadFeed();
            } else {
                // Agar login nahi hai toh sirf Login Page dikhao
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainAppPage').style.display = 'none';
            }
        });

        // 3. Post Karne ka Logic
        function postNow() {
            const text = document.getElementById('msg').value;
            if (text.trim()) {
                db.ref('posts').push({
                    name: auth.currentUser.displayName,
                    pic: auth.currentUser.photoURL,
                    message: text,
                    time: Date.now()
                });
                document.getElementById('msg').value = "";
            }
        }

        // 4. Main Page par Feed dikhane ka logic
        function loadFeed() {
            db.ref('posts').limitToLast(10).on('value', snap => {
                const feed = document.getElementById('postFeed');
                feed.innerHTML = "";
                const data = snap.val();
                if (data) {
                    Object.keys(data).reverse().forEach(key => {
                        const p = data[key];
                        feed.innerHTML += `
                            <div class="fb-post">
                                <div class="post-top">
                                    <img src="${p.pic}">
                                    <b>${p.name}</b>
                                </div>
                                <div class="post-content">${p.message}</div>
                                <div style="color:#65676b; font-size:13px; font-weight:600; border-top:1px solid #eee; padding-top:8px;">
                                    üëç Like &nbsp;&nbsp; üí¨ Comment
                                </div>
                            </div>`;
                    });
                }
            });
        }
    </script>
</body>
</html>
