<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Friendsion Smart Diary</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#f4f2e9;
}

/* HEADER */
header{
    background:#4267B2;
    color:white;
    padding:15px;
    font-size:22px;
    text-align:center;
}

/* CONTAINER */
.container{
    width:95%;
    max-width:900px;
    margin:20px auto;
}

/* POST BOX */
.post-box{
    background:white;
    padding:15px;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
    margin-bottom:20px;
}

textarea{
    width:100%;
    height:100px;
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
}

button{
    padding:8px 15px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}

/* DIARY STYLE */
.diary{
    perspective:1000px;
    margin-bottom:20px;
}

.page{
    width:100%;
    background:#fff8dc;
    padding:20px;
    border-radius:8px;
    transform-style:preserve-3d;
    transition:transform 0.8s;
    position:relative;
}

.page.flip{
    transform:rotateY(180deg);
}

.cover{
    width:100%;
    height:200px;
    object-fit:cover;
    border-radius:8px;
    margin-bottom:10px;
}

.actions{
    margin-top:10px;
}

.comment-box{
    margin-top:10px;
}

.comment{
    background:#eee;
    padding:5px;
    margin-top:5px;
    border-radius:5px;
}

/* FRIENDS */
.friend-section{
    background:white;
    padding:10px;
    border-radius:10px;
    margin-top:20px;
}

.friend{
    display:flex;
    justify-content:space-between;
    margin-top:5px;
}

/* CHAT */
.chat{
    position:fixed;
    right:20px;
    bottom:20px;
    width:250px;
    background:white;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
}

.chat-header{
    background:#4267B2;
    color:white;
    padding:8px;
}

.chat-messages{
    height:200px;
    overflow-y:auto;
    padding:5px;
}

.chat-input{
    display:flex;
}

.chat-input input{
    flex:1;
    border:none;
    padding:5px;
}

.chat-input button{
    background:#4267B2;
    color:white;
}
</style>
</head>

<body>

<header>Friendsion - Smart Diary</header>

<div class="container">

<div class="post-box">
<input type="file" id="coverInput"><br><br>
<textarea id="postText" placeholder="Write your diary..."></textarea><br><br>
<button onclick="createPost()">Publish Diary</button>
</div>

<div id="posts"></div>

<div class="friend-section">
<h3>Friends</h3>
<input type="text" id="friendName" placeholder="Friend name">
<button onclick="addFriend()">Add</button>
<div id="friendList"></div>
</div>

</div>

<div class="chat">
<div class="chat-header">Global Chat</div>
<div class="chat-messages" id="chatMessages"></div>
<div class="chat-input">
<input type="text" id="chatInput">
<button onclick="sendMessage()">Send</button>
</div>
</div>

<script>
let posts = JSON.parse(localStorage.getItem("posts")) || [];
let friends = JSON.parse(localStorage.getItem("friends")) || [];
let chat = JSON.parse(localStorage.getItem("chat")) || [];

/* SAVE */
function saveData(){
    localStorage.setItem("posts",JSON.stringify(posts));
    localStorage.setItem("friends",JSON.stringify(friends));
    localStorage.setItem("chat",JSON.stringify(chat));
}

/* CREATE POST */
function createPost(){
    let text = document.getElementById("postText").value;
    let file = document.getElementById("coverInput").files[0];
    if(!text) return alert("Write something!");

    let reader = new FileReader();
    reader.onload = function(e){
        posts.unshift({
            text:text,
            cover:e.target.result,
            likes:0,
            comments:[]
        });
        saveData();
        renderPosts();
    }
    if(file) reader.readAsDataURL(file);
    else{
        posts.unshift({text:text,cover:"",likes:0,comments:[]});
        saveData();
        renderPosts();
    }

    document.getElementById("postText").value="";
}

/* RENDER POSTS */
function renderPosts(){
    let html="";
    posts.forEach((p,i)=>{
        html+=`
        <div class="diary">
            <div class="page" onclick="flipPage(this)">
                ${p.cover ? `<img src="${p.cover}" class="cover">`:""}
                <p>${p.text}</p>
                <div class="actions">
                    ❤️ ${p.likes}
                    <button onclick="likePost(${i});event.stopPropagation()">Like</button>
                    <button onclick="deletePost(${i});event.stopPropagation()">Delete</button>
                </div>
                <div class="comment-box">
                    <input type="text" id="c${i}">
                    <button onclick="addComment(${i});event.stopPropagation()">Comment</button>
                    ${p.comments.map(c=>`<div class="comment">${c}</div>`).join("")}
                </div>
            </div>
        </div>
        `;
    });
    document.getElementById("posts").innerHTML=html;
}

/* FLIP */
function flipPage(el){
    el.classList.toggle("flip");
}

/* LIKE */
function likePost(i){
    posts[i].likes++;
    saveData();
    renderPosts();
}

/* DELETE */
function deletePost(i){
    posts.splice(i,1);
    saveData();
    renderPosts();
}

/* COMMENT */
function addComment(i){
    let val=document.getElementById("c"+i).value;
    if(!val) return;
    posts[i].comments.push(val);
    saveData();
    renderPosts();
}

/* FRIENDS */
function addFriend(){
    let name=document.getElementById("friendName").value;
    if(!name) return;
    friends.push({name:name,blocked:false});
    saveData();
    renderFriends();
}

function renderFriends(){
    let html="";
    friends.forEach((f,i)=>{
        html+=`
        <div class="friend">
            ${f.blocked ? "<s>"+f.name+"</s>" : f.name}
            <div>
                <button onclick="blockFriend(${i})">Block</button>
                <button onclick="deleteFriend(${i})">Delete</button>
            </div>
        </div>
        `;
    });
    document.getElementById("friendList").innerHTML=html;
}

function blockFriend(i){
    friends[i].blocked=!friends[i].blocked;
    saveData();
    renderFriends();
}

function deleteFriend(i){
    friends.splice(i,1);
    saveData();
    renderFriends();
}

/* CHAT */
function sendMessage(){
    let msg=document.getElementById("chatInput").value;
    if(!msg) return;
    chat.push(msg);
    document.getElementById("chatInput").value="";
    saveData();
    renderChat();
}

function renderChat(){
    let html="";
    chat.forEach(m=>{
        html+=`<div>${m}</div>`;
    });
    document.getElementById("chatMessages").innerHTML=html;
}

renderPosts();
renderFriends();
renderChat();
</script>

</body>
</html>
