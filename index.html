<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Friendsion 11 - Smart Diary</title>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{
background:#f0e6d2;
font-family:'Segoe UI',sans-serif;
margin:0;
display:flex;
flex-direction:column;
align-items:center;
padding-bottom:100px;
}

/* USER INFO */
.user-info{
display:flex;
align-items:center;
gap:10px;
background:white;
padding:10px 20px;
border-radius:30px;
margin:20px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
.user-info img{
width:40px;
height:40px;
border-radius:50%;
}

/* POST BOX */
.post-box{
background:white;
padding:20px;
border-radius:15px;
width:90%;
max-width:400px;
box-shadow:0 10px 25px rgba(0,0,0,0.1);
margin-bottom:20px;
}
textarea{
width:100%;
padding:10px;
border-radius:10px;
border:1px solid #ddd;
resize:none;
}
.file-label{
display:block;
background:#eee;
padding:10px;
text-align:center;
border-radius:10px;
cursor:pointer;
margin-bottom:10px;
}

/* BOOK */
.book-container{ perspective:1500px; margin:40px 0; }
.book{ position:relative; width:320px; height:450px; }
.page{
position:absolute;
width:100%;
height:100%;
background:#fffef0;
border:1px solid #d4af37;
border-radius:0 15px 15px 0;
transform-origin:left;
transition:0.8s;
backface-visibility:hidden;
overflow:hidden;
}
.cover{
background:linear-gradient(45deg,#ff00cc,#3333ff);
color:white;
display:flex;
flex-direction:column;
align-items:center;
justify-content:space-between;
padding:20px 0;
cursor:pointer;
}
.cover img{
width:85%;
height:220px;
object-fit:cover;
border-radius:10px;
}
.flipped{ transform:rotateY(-180deg); }

/* NAV */
.nav-controls{
position:absolute;
bottom:20px;
width:100%;
display:flex;
justify-content:space-between;
padding:0 20px;
box-sizing:border-box;
}
.nav-btn{
background:#d4af37;
color:white;
border:none;
padding:5px 12px;
border-radius:5px;
cursor:pointer;
}

/* COMMENTS */
.comment-section{
background:#f9f9f9;
padding:10px;
border-radius:10px;
margin-top:10px;
}
.comment{
background:white;
padding:5px 8px;
margin-top:5px;
border-radius:5px;
font-size:12px;
}

/* CHAT */
.chat-btn{
position:fixed;
bottom:20px;
right:20px;
background:#25d366;
width:60px;
height:60px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:28px;
color:white;
cursor:pointer;
}
.chat-window{
position:fixed;
bottom:90px;
right:20px;
width:320px;
height:450px;
background:#e5ddd5;
border-radius:10px;
display:none;
flex-direction:column;
overflow:hidden;
}
.chat-header{
background:#075e54;
color:white;
padding:15px;
display:flex;
justify-content:space-between;
}
#chatMsgs{
flex:1;
overflow-y:auto;
padding:10px;
display:flex;
flex-direction:column;
gap:8px;
}
.msg{
padding:8px 12px;
border-radius:10px;
max-width:75%;
font-size:13px;
}
.sent{ background:#dcf8c6; align-self:flex-end; }
.received{ background:white; align-self:flex-start; }
.chat-input{
display:flex;
background:#f0f0f0;
padding:10px;
gap:5px;
}
.chat-input input{
flex:1;
border:none;
padding:8px;
border-radius:20px;
}
.chat-input button{
background:#075e54;
color:white;
border:none;
padding:0 15px;
border-radius:50%;
}
</style>
</head>
<body>

<div id="loginArea">
<button onclick="login()" style="margin-top:100px;padding:20px 40px;border-radius:50px;border:none;background:linear-gradient(to right,#d4af37,#f1c40f);font-weight:bold;cursor:pointer;">
Unlock Golden Diary
</button>
</div>

<div id="mainApp" style="display:none;flex-direction:column;align-items:center;width:100%;">

<div class="user-info">
<img id="userPic">
<span id="userName"></span>
</div>

<div class="post-box">
<label class="file-label">
üì∏ Choose Cover Photo
<input type="file" id="coverInp" accept="image/*" style="display:none;">
</label>
<textarea id="diaryText" placeholder="Write your heart..." rows="4"></textarea>
<button onclick="savePost()" style="width:100%;margin-top:10px;background:#d4af37;color:white;border:none;padding:12px;border-radius:10px;">
Publish Diary
</button>
</div>

<div id="feed"></div>
</div>

<div class="chat-btn" onclick="toggleChat()">üí¨</div>

<div class="chat-window" id="chatWindow">
<div class="chat-header">
<span>Global Chat</span>
<span onclick="toggleChat()" style="cursor:pointer">‚úï</span>
</div>
<div id="chatMsgs"></div>
<div class="chat-input">
<input type="text" id="chatInp" placeholder="Type...">
<button onclick="sendMsg()">‚û§</button>
</div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyAUJzZ5RKf_-vu7gUDI3Frr4B2MbqgC3Yg",
authDomain:"friendsion-11-9e786.firebaseapp.com",
databaseURL:"https://friendsion-11-9e786-default-rtdb.firebaseio.com",
projectId:"friendsion-11-9e786"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

let userData=null;
let selectedImg="";

/* LOGIN */
function login(){
auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(res=>{
userData=res.user;
document.getElementById('loginArea').style.display="none";
document.getElementById('mainApp').style.display="flex";
document.getElementById('userPic').src=userData.photoURL;
document.getElementById('userName').innerText=userData.displayName;
loadPosts();
loadChat();
});
}

/* IMAGE */
document.getElementById('coverInp').onchange=e=>{
const file=e.target.files[0];
if(!file)return;
const reader=new FileReader();
reader.onload=ev=>selectedImg=ev.target.result;
reader.readAsDataURL(file);
};

/* SAVE POST */
function savePost(){
const text=document.getElementById('diaryText').value;
if(!text||!selectedImg)return alert("Photo & text required");

const pages=text.match(/.{1,300}/g);

db.ref("posts").push({
uid:userData.uid,
name:userData.displayName,
pic:userData.photoURL,
cover:selectedImg,
pages:pages,
likes:{},
time:Date.now()
});

document.getElementById('diaryText').value="";
selectedImg="";
}

/* LOAD POSTS */
function loadPosts(){
db.ref("posts").on("value",snap=>{
const feed=document.getElementById('feed');
feed.innerHTML="";
snap.forEach(child=>{
const d=child.val();
const id=child.key;
const liked=d.likes && d.likes[userData.uid];

feed.innerHTML+=`
<div class="book-container">
<div class="book">
<div class="page cover" onclick="flipPage(this,'next')">
<div style="display:flex;gap:8px;align-items:center;">
<img src="${d.pic}" width="30" style="border-radius:50%">
<span>${d.name}</span>
</div>
<img src="${d.cover}">
${d.uid===userData.uid?`<button onclick="event.stopPropagation();deletePost('${id}')">Delete</button>`:`Tap to Read`}
</div>

${d.pages.map((p,i)=>`
<div class="page">
<div style="padding:30px;">${p}</div>
<div class="nav-controls">
<button class="nav-btn" onclick="flipPage(this,'prev')">Back</button>
<span>Page ${i+1}</span>
<button class="nav-btn" onclick="flipPage(this,'${i===d.pages.length-1?'reset':'next'}')">
${i===d.pages.length-1?'Read Again':'Next'}
</button>
</div>
</div>
`).join("")}
</div>

<button onclick="likePost('${id}')" style="margin-top:10px;">
${liked?"üíñ Liked":"ü§ç Like"} (${d.likes?Object.keys(d.likes).length:0})
</button>

<div class="comment-section">
<input type="text" id="c_${id}" placeholder="Write comment">
<button onclick="addComment('${id}')">Post</button>
<div id="comments_${id}"></div>
</div>
</div>
`;

loadComments(id);
});
});
}

/* FLIP */
function flipPage(btn,action){
const page=btn.closest('.page');
const book=btn.closest('.book');
if(action==='next')page.classList.add('flipped');
if(action==='prev'){
const flipped=book.querySelectorAll('.flipped');
if(flipped.length)flipped[flipped.length-1].classList.remove('flipped');
}
if(action==='reset'){
book.querySelectorAll('.page').forEach(p=>p.classList.remove('flipped'));
}
}

/* DELETE */
function deletePost(id){
if(confirm("Delete?"))db.ref("posts/"+id).remove();
}

/* LIKE */
function likePost(id){
db.ref("posts/"+id+"/likes/"+userData.uid).set(true);
}

/* COMMENTS */
function addComment(id){
const text=document.getElementById("c_"+id).value;
if(!text)return;
db.ref("posts/"+id+"/comments").push({
name:userData.displayName,
text:text
});
document.getElementById("c_"+id).value="";
}

function loadComments(id){
db.ref("posts/"+id+"/comments").on("value",snap=>{
const box=document.getElementById("comments_"+id);
if(!box)return;
box.innerHTML="";
snap.forEach(c=>{
const d=c.val();
box.innerHTML+=`<div class="comment"><b>${d.name}:</b> ${d.text}</div>`;
});
});
}

/* CHAT */
function toggleChat(){
const win=document.getElementById("chatWindow");
win.style.display=win.style.display==="flex"?"none":"flex";
}

function sendMsg(){
const inp=document.getElementById("chatInp");
if(!inp.value)return;
db.ref("chat").push({
uid:userData.uid,
name:userData.displayName,
text:inp.value
});
inp.value="";
}

function loadChat(){
db.ref("chat").limitToLast(30).on("value",snap=>{
const box=document.getElementById("chatMsgs");
box.innerHTML="";
snap.forEach(c=>{
const m=c.val();
box.innerHTML+=`
<div class="msg ${m.uid===userData.uid?'sent':'received'}">
<b>${m.uid===userData.uid?'You':m.name}</b><br>
${m.text}
</div>
`;
});
box.scrollTop=box.scrollHeight;
});
}
</script>
</body>
</html>
